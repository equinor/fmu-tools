

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rms.update_petro_parameters &mdash; fmu-tools 1.22.1.dev1+g87d515a documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=07676708"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="rms.export_and_import_field_parameters" href="export_and_import_fields.html" />
    <link rel="prev" title="rms.create_bw_per_facies" href="generate_bw_per_facies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            fmu-tools
              <img src="_static/equinor-logo2.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">fmu-tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="fmudesign.html">FMU design matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="qcforward.html">The qcforward functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="qcproperties.html">The qcproperties class</a></li>
<li class="toctree-l1"><a class="reference internal" href="qcreset.html">The qcreset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="generate_petro_jobs_for_field_update.html">rms.generate_petro_jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="properties.html">The properties package</a></li>
<li class="toctree-l1"><a class="reference internal" href="domain_conversion.html">Domain conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_rft_ertobs.html">create_rft_ertobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="rename_rms_scripts.html">rms.rename_rms_scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="rms_import_localmodule.html">rms.import_localmodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="generate_bw_per_facies.html">rms.create_bw_per_facies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">rms.update_petro_parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-describing-the-workflow">Example describing the workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-of-rms-python-job-running-this-module-to-combine-the-field-parameters">Example of RMS python job running this module to combine the field parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="export_and_import_fields.html">rms.export_and_import_field_parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy_rms_param_to_ertbox_grid.html">rms.copy_rms_param</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">The fmu-tools utilities package</a></li>
<li class="toctree-l1"><a class="reference internal" href="rmsvolumetrics2csv.html">rmsvolumetrics2csv</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API for fmu.tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fmu-tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">rms.update_petro_parameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/update_petro_real.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rms-update-petro-parameters">
<h1>rms.update_petro_parameters<a class="headerlink" href="#rms-update-petro-parameters" title="Link to this heading"></a></h1>
<p>When running FMU project where field parameters for both facies and
petrophysical properties are updated in ERT simultaneously,
some adjustments are needed in the RMS project to support this type
of workflow. It is necessary to have one petrosim job per facies.</p>
<p>The module <em>update_petro_parameters</em> will combine values from realization
of a petrophysical property for individual facies into one common
petrophysical realization by using the facies realization as filter.</p>
<section id="example-describing-the-workflow">
<h2>Example describing the workflow<a class="headerlink" href="#example-describing-the-workflow" title="Link to this heading"></a></h2>
<p>The zone Valysar has four different facies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Floodplain</span>
<span class="n">Channel</span>
<span class="n">Crevasse</span>
<span class="n">Coal</span>
</pre></div>
</div>
<p>A petrophysical realization is made for PHIT and KLOGH for each of the three
first facies with property names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Floodplain_PHIT</span>
<span class="n">Floodplain_KLOGH</span>
<span class="n">Channel_PHIT</span>
<span class="n">Channel_KLOGH</span>
<span class="n">Crevasse_PHIT</span>
<span class="n">Crevasse_KLOGH</span>
</pre></div>
</div>
<p>Neither PHIT nor KLOGH are updated as field parameters for facies
Coal since they have constant (not spatially varying) values and
may even have no uncertainty specified.
The variables VSH and VPHYL are chosen not to be used as field parameters
in ERT in assisted history matching in this example
and therefore not included here,
but still used in the RMS workflow with the prior values.</p>
<p>The original realizations created for PHIT and KLOGH are conditioned
to facies. In a workflow where we want to use both facies by applying
the Adaptive PluriGaussian Simulation method (APS) and PHIT and KLOG
for some selected facies as field parameters to be updated by ERT,
we will need the separate PHIT and KLOGH realizations for the selected
facies.</p>
<p>The steps will be:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use original petrophysical job to create initial version of a realization of
PHIT, KLOGH, VSH and VPHYL.</p></li>
<li><p>Use separate petrophysical jobs to create separate version of realizations of
Floodplain_PHIT, Floodplain_KLOGH and so on.</p></li>
<li><p>Use the script <em>update_petro_parameters</em> to copy the values for PHIT and KLOGH from
the individual realizations per facies into the initial version of PHIT and KLOG
by overwriting the values in the original version. In this process,
the facies realization is used as a filter to select which grid cell values
to get from the individual PHIT and KLOGH parameters that belongs to the
various facies.</p></li>
</ul>
</div></blockquote>
<p>When running ERT iteration 0 which creates the initial ensemble, this looks a bit unnecessary,
since the initial PHIT and KLOGH already has taken facies into account. But, when running
ERT iteration larger than 0 (after ERT has updated the fields Floodplain_PHIT,
Floodplain_KLOGH and so on), then updated versions of the field parameters are imported
and updated version of facies realization is used to update the PHIT and KLOGH parameters
from the imported field parameters (Floodplain_PHIT, Floodplain_KLOGH …).</p>
<p>Also for iteration 0, to ensure consistency the same procedure
(copy from the field parameters Floodplain_PHIT, Floodplain_KLOG,..) is
applied since this ensure consistent handling of the realizations.</p>
</section>
<section id="example-of-rms-python-job-running-this-module-to-combine-the-field-parameters">
<h2>Example of RMS python job running this module to combine the field parameters<a class="headerlink" href="#example-of-rms-python-job-running-this-module-to-combine-the-field-parameters" title="Link to this heading"></a></h2>
<p>The python job below will call the <em>update_petro_parameters</em> function that does the
combination of the field parameters into one petrophysical realization.
This job depends on a small config file ( the same config file that is used by the
function <em>generate_petro_jobs</em>  from fmu.tools.rms module). Here the python job gets
the grid name and which of the petrophysical properties for which facies
to be updated as field parameters in ERT. The script also depends on the facies table
(which facies code and name belongs together).
This can be fetched from the <em>global_variables.yml</em> file as shown in the example below.</p>
<p>An alternative is to add a key <em>USED_PETRO_FIELDS</em>  in global_master_config.yml
and get the petro parameters per facies per zone from this keyword instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fmu.tools.rms</span><span class="w"> </span><span class="kn">import</span> <span class="n">update_petro_parameters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fmu.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">utilities</span> <span class="k">as</span> <span class="n">ut</span>

<span class="n">DEBUG_PRINT</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Choose either to use config file or input from global variable file</span>
<span class="n">USE_CONFIG_FILES</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">CFG</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">yaml_load</span><span class="p">(</span><span class="s2">&quot;../../fmuconfig/output/global_variables.yml&quot;</span><span class="p">)[</span><span class="s2">&quot;global&quot;</span><span class="p">]</span>
<span class="n">FACIES_ZONE</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;FACIES_ZONE&quot;</span><span class="p">]</span>

<span class="c1"># Used if alternative 1 with config file is used</span>
<span class="n">CONFIG_FILES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Valysar&quot;</span><span class="p">:</span> <span class="s2">&quot;../input/config/field_update/generate_petro_jobs_valysar.yml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Therys&quot;</span><span class="p">:</span>  <span class="s2">&quot;../input/config/field_update/generate_petro_jobs_therys.yml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Volon&quot;</span><span class="p">:</span>   <span class="s2">&quot;../input/config/field_update/generate_petro_jobs_volon.yml&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Used if alternative 2 without config file is used</span>
<span class="c1"># In this case the global master config must be updated</span>
<span class="c1"># to define the dictionary with used petro fields per zone per facies</span>
<span class="n">USED_PETRO_FIELDS</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;USED_PETRO_FIELDS&quot;</span><span class="p">]</span>
<span class="n">GRID_NAMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Valysar&quot;</span><span class="p">:</span> <span class="s2">&quot;Geogrid_Valysar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Therys&quot;</span><span class="p">:</span>  <span class="s2">&quot;Geogrid_Therys&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Volon&quot;</span><span class="p">:</span>   <span class="s2">&quot;Geogrid_Volon&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">FACIES_REAL_NAMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Valysar&quot;</span><span class="p">:</span> <span class="s2">&quot;FACIES&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Therys&quot;</span><span class="p">:</span>  <span class="s2">&quot;FACIES&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Volon&quot;</span><span class="p">:</span>   <span class="s2">&quot;FACIES&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># For multi zone grids also zone_param_name and zone_code_names must be specified</span>
<span class="c1"># Example:</span>
<span class="c1">#   ZONE_PARAM_NAME = &quot;Zone&quot;</span>
<span class="c1">#   ZONE_CODE_NAMES = {</span>
<span class="c1">#      1: &quot;Valysar,</span>
<span class="c1">#      2: &quot;Therys&quot;,</span>
<span class="c1">#      3: &quot;Volon&quot;,</span>
<span class="c1">#   }</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Drogon uses 3 different grids and single zone grids</span>
    <span class="k">if</span> <span class="n">USE_CONFIG_FILES</span><span class="p">:</span>
        <span class="c1"># Alternative 1 using config file common with generate_petro_jobs</span>
        <span class="k">for</span> <span class="n">zone_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Valysar&quot;</span><span class="p">,</span> <span class="s2">&quot;Therys&quot;</span><span class="p">,</span> <span class="s2">&quot;Volon&quot;</span><span class="p">]:</span>
            <span class="n">facies_code_names</span> <span class="o">=</span>  <span class="n">FACIES_ZONE</span><span class="p">[</span><span class="n">zone_name</span><span class="p">]</span>
            <span class="n">config_file</span> <span class="o">=</span> <span class="n">CONFIG_FILES</span><span class="p">[</span><span class="n">zone_name</span><span class="p">]</span>
            <span class="n">update_petro_parameters</span><span class="p">(</span>
                <span class="n">project</span><span class="p">,</span>
                <span class="n">facies_code_names</span><span class="p">,</span>
                <span class="n">zone_name_for_single_zone_grid</span><span class="o">=</span><span class="n">zone_name</span><span class="p">,</span>
                <span class="n">config_file</span><span class="o">=</span><span class="n">config_file</span><span class="p">,</span>
                <span class="n">debug_print</span><span class="o">=</span><span class="n">DEBUG_PRINT</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Alternative 2 specify input using global_variables file</span>
        <span class="k">for</span> <span class="n">zone_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Valysar&quot;</span><span class="p">,</span> <span class="s2">&quot;Therys&quot;</span><span class="p">,</span> <span class="s2">&quot;Volon&quot;</span><span class="p">]:</span>
            <span class="n">facies_code_names</span> <span class="o">=</span>  <span class="n">FACIES_ZONE</span><span class="p">[</span><span class="n">zone_name</span><span class="p">]</span>
            <span class="n">grid_name</span> <span class="o">=</span> <span class="n">GRID_NAMES</span><span class="p">[</span><span class="n">zone_name</span><span class="p">]</span>
            <span class="n">facies_real_name</span> <span class="o">=</span> <span class="n">FACIES_REAL_NAMES</span><span class="p">[</span><span class="n">zone_name</span><span class="p">]</span>
            <span class="n">used_petro_per_facies</span><span class="o">=</span><span class="n">USED_PETRO_FIELDS</span>
            <span class="n">update_petro_parameters</span><span class="p">(</span>
                <span class="n">project</span><span class="p">,</span>
                <span class="n">facies_code_names</span><span class="p">,</span>
                <span class="n">grid_name</span><span class="o">=</span><span class="n">grid_name</span><span class="p">,</span>
                <span class="n">facies_real_name</span><span class="o">=</span><span class="n">facies_real_name</span><span class="p">,</span>
                <span class="n">used_petro_dict</span><span class="o">=</span><span class="n">used_petro_per_facies</span><span class="p">,</span>
                <span class="n">zone_name_for_single_zone_grid</span><span class="o">=</span><span class="n">zone_name</span><span class="p">,</span>
                <span class="n">debug_print</span><span class="o">=</span><span class="n">DEBUG_PRINT</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>global_master_config.yml</em> file can include a keyword for <em>USED_PETRO_FIELDS</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">USED_PETRO_FIELDS</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Valysar</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Floodplain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">Channel</span><span class="p">:</span><span class="w">    </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">Crevasse</span><span class="p">:</span><span class="w">   </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">Therys</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Offshore</span><span class="p">:</span><span class="w">       </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">Lowershoreface</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">Uppershoreface</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">Volon</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Floodplain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">Channel</span><span class="p">:</span><span class="w">    </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">PHIT</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">KLOGH</span><span class="w"> </span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>and optionally also for multizone grid:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ZONE_CODE_NAMES</span><span class="p">:</span>
<span class="w">    </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Valysar</span>
<span class="w">    </span><span class="nt">2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Therys</span>
<span class="w">    </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Volon</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="generate_bw_per_facies.html" class="btn btn-neutral float-left" title="rms.create_bw_per_facies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="export_and_import_fields.html" class="btn btn-neutral float-right" title="rms.export_and_import_field_parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Equinor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #ff1243;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #474747;
    }
    .wy-side-nav-search > div.version {
      color: white;
    }
  </style>


</body>
</html>